<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>DAppWall</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="styles.css" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>DAppWall</h1>
        <form id="ip-form" method="POST">
            <label for="id">ID: </label>
            <input id="id" name="id" type="text" placeholder="Enter an ID">
            </br>
            <label for="ip">IP: </label>
            <input id="ip" name="ip" type="text" placeholder="Enter an IP">
            <button type="submit">Go</button>
        </form>
    </div>

    <script src="main.js"></script>
    <script>
        window.addEventListener('load', () => {
             // Modern dapp browsers...
            if (window.ethereum) {
                window.web3 = new Web3(ethereum);
                try {
                    // Request account access if needed
                    ethereum.enable();
                    // Acccounts now exposed
                    web3.eth.sendTransaction({/* ... */});
                } catch (error) {
                    // User denied account access...
                }
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
                // Acccounts always exposed
                web3.eth.sendTransaction({/* ... */});
                console.log(web3.currentProvider);
            }
            // Non-dapp browsers...
            else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
            }

            if (web3) {
                if (web3.eth.accounts.length) {
                    // if not locked, get account
                    const account = web3.eth.accounts[0];
                    // updates UI, state, pull data
                } else {
                    // locked. update UI. Ask user to unlock.
                    console.log('Your account is locked');
                }

                switch (web3.version.network) {
                    case '1':
                        console.log('This is mainnet');
                        break;
                    case '2':
                        console.log('This is the deprecated Morden test network.');
                        break;
                    case '3':
                        console.log('This is the ropsten test network.');
                        break;
                    case '4':
                        console.log('This is the Rinkeby test network.');
                        break;
                    case '42':
                        console.log('This is the Kovan test network.');
                        break;
                    default:
                        console.log('This is an unknown network.');
                        break;
                }

                const desiredNetwork = '4';
                if (web3.version.network !== desiredNetwork) {
                    // ask user to switch to desired network
                    console.log('Please switch to Rinkeby network.');
                }

                const DappWallABI = [
                    {
                        "constant": false,
                        "inputs": [
                            {
                                "name": "_swarmHashList",
                                "type": "bytes32"
                            }
                        ],
                        "name": "update",
                        "outputs": [],
                        "payable": true,
                        "stateMutability": "payable",
                        "type": "function"
                    },
                    {
                        "anonymous": false,
                        "inputs": [
                            {
                                "indexed": true,
                                "name": "_from",
                                "type": "address"
                            },
                            {
                                "indexed": true,
                                "name": "_swarmHashList",
                                "type": "bytes32"
                            }
                        ],
                        "name": "listIP",
                        "type": "event"
                    }
                ];
                const DappWallContract = new web3.eth.Contract(DappWallABI, '0x6a826edef7645119bf0f3fea05a480f9bb89fb9a');

                window.contract = DappWallContract;
            }
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>